---
title: 从 ClashX 切换到 ClashX.Meta 后，CLI 工具无法联网的原因与解决
slug: clashx-clashxmeta-cli-proxy-issue
publishDate: 2025-12-17
category: tech
---

最近把代理工具从 [ClashX](https://github.com/yichengchen/clashX) 换成了 [ClashX.Meta](https://github.com/MetaCubeX/ClashX.Meta)，结果发现：**浏览器能正常科学上网，但 `git push` 卡住，`gemini`、`qwen` 这类 CLI AI Agent 也无法联网。**

问了 AI 才搞明白：**macOS 的"系统代理"开关，其实只对浏览器有效。像终端、Python 脚本、Node 工具链，以及 CLI AI Agent，根本不会自动走这个代理。**

用这篇文章记录一下从困惑到解决的全过程。

---

## 一、问题现象

在 ClashX.Meta 里点了 "Set as System Proxy"，然后：

- ✅ 浏览器能正常科学上网，IP 也变为了代理节点；
- ❌ 但在终端里 `git push` 一直超时；
- ❌ `gemini`、`qwen` 等 CLI AI Agent 报 API 超时错误。

---

## 二、排查：7891 端口真的在监听吗？

ClashX.Meta 的设置里明明写着 `Proxy Port: 7891`，那它应该在监听才对。于是我打开终端：

```bash
netstat -an | grep 7891
```

**没有任何输出。**

这就奇怪了——如果端口没在监听，那"系统代理"设了也白设。

我又担心是不是旧版 ClashX 没清干净，于是查了下 `7890`（ClashX 默认端口）：

```bash
lsof -i :7890
```

输出了一行：

```
StocksWid 802 ryanchan ... TCP ... (CLOSED)
```

`(CLOSED)` 表示这是一个**已经断开的连接尝试**，不是服务在运行。再用 `netstat` 检查 `LISTEN` 状态，确认 7890 是空的。

所以结论很明确：**问题不在旧软件残留，而在 ClashX.Meta 没把 7891 端口真正跑起来。**

---

## 三、原因：两个代理工具"改端口"的方式不一样

其实问题出在 ClashX 和 ClashX.Meta 对配置文件的处理方式不同。

用的是同一个远程配置文件，在 ClashX 里可以通过 GUI 直接改端口，但换了 ClashX.Meta 之后，设置里看到 `Proxy Port: 7891`，可终端连不上，Proxifier 也报错。查了半天才发现：**ClashX.Meta 根本没在 7891 上监听。**

翻了下 [它的 GitHub 页面](https://github.com/MetaCubeX/ClashX.Meta)，README 里写得很清楚：

> "Please modify the config.yaml file generated by ClashX, not the other config file you created or downloaded. The General section settings in your custom config file would be ignored."
>

简单说就是：**如果你用的是自己导入的配置文件，那 GUI 里改的端口是不算数的**。ClashX.Meta 只认配置文件里写的 `port` 和 `mixed-port`。

而配置文件里写的是：

```yaml
port: 7890
mixed-port: 7893
```

实际上 ClashX.Meta 只监听了配置文件中定义的 `7890`和 `7893`，并未使用 GUI 中设置的 `7891`。

但 macOS 的「系统代理」仍被自动设置为 `7891`，导致系统请求被发送到一个未监听的端口，自然无法建立连接。

相比之下，`7893` 始终是可用的，只是之前没有意识到系统应当使用该端口。

---

## 四、解决：让开发工具都走 `7893`

`mixed-port`（默认 7893）是 Clash 的"混合端口"，同时支持 HTTP 和 SOCKS5，**特别适合命令行和开发工具**。接下来就是让各个工具知道该去哪儿找代理。

### 1. 终端（zsh）——加环境变量

编辑 `~/.zshrc`（用 `nano ~/.zshrc` 或 `code ~/.zshrc`）：

```bash
# 走 ClashX.Meta 的 mixed-port
export http_proxy="<http://127.0.0.1:7893>"
export https_proxy="<http://127.0.0.1:7893>"
export no_proxy="localhost,127.0.0.1,::1,.local"
```

保存后执行：

```bash
source ~/.zshrc
```

现在 `curl`、`git`、`npm`、`pip`，以及 `gemini`、`qwen` 等 CLI 工具都能正常走代理了。

### 2. Git 单独配置

虽然 Git 会读 `https_proxy`，但显式设置更保险：

```bash
git config --global http.proxy <http://127.0.0.1:7893>
git config --global https.proxy <http://127.0.0.1:7893>
```